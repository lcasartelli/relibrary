
<dom-module id="book-detail-element">
  <style>
    .stream .list-item  {
      display: inline-block;
      width: 100%;
    }
    .readmore a {
      color:#000;
    }
    .wrapper {
      margin-top: 10px;
    }
    paper-toolbar p {
      margin: 0;
      padding: 0;
    }
    .row-badges {
      border-top: 1px solid grey;
      padding: 11px 0px;
      position: relative;
    }
    .row-badges.last {
      border-bottom: 1px solid grey;
    }
    .container-create-icon {
      padding: 0px;
      text-align: right;
    }
    .container-create-icon paper-button {
      min-width: 3em;
    }
  </style>
  <template>
    <paper-header-panel flex>
      <paper-toolbar role="toolbar" elevation="1">
        <div class='back' on-click="goBack">
          <paper-icon-button id="navicon" icon="arrow-back"></paper-icon-button>
        </div>
        <p>Harry Potter e la pietra filosofale</p>
      </paper-toolbar>
      <div class='container wrapper'>
        <!-- BOOK COVER -->
        <div class='row'>
          <div class='col-xs-4'>
            <img src="http://lorempixel.com/130/200" class="img-responsive"/>
          </div>
          <!-- BOOK INFO -->
          <div class='col-xs-8'>
            <h3 class='title'>Harry Potter e la pietra Filosofale</h3>
            <small class='author'>J.K. Rowling</small>
            <rating-element></rating-element>
            <!-- <p class='rating' style='color: red'> TODO Valutazione</p> -->
          </div>
        </div>
        <hr class='transparent-divider'/>
        <div class='row row-badges'>
          <!--BADGES -->
          <div class='col-xs-12'>
            <div class='col-xs-9'>
              <h4>Stato del libro: <small>Letto</small></h4>
            </div>
            <div class='col-xs-3 container-create-icon'>
              <paper-button raised class='edit-button' on-click='openStatusBookDialog'>
                 <iron-icon icon="create"></iron-icon>
              </paper-button>
            </div>
          </div>
        </div>
        <div class='row row-badges last'>
          <div class='col-xs-12'>
            <div class='col-xs-9'>
              <h4>Acquistato: <small>Sì</small></h4>
            </div>
            <div class='col-xs-3 container-create-icon'>
              <paper-button raised class='edit-button' on-click='openStatusBoughtDialog'>
                 <iron-icon icon="create"></iron-icon>
              </paper-button>
            </div>
          </div>
        </div>
        <hr class='transparent-divider'/>
        <!-- TRAMA -->
        <div class='row'>
          <div class='col-xs-12'>
            <h4>Trama</h4>
          </div>
        </div>
        <div class='row'>
          <div class='col-xs-12'>
            <p class='trama-content'>1º novembre 1981. A Little Whinging, in Inghilterra, è il giorno in cui uno strano e anziano signore di nome Albus Silente (preside della scuola di magia e stregoneria di Hogwarts) lascia un neonato di un anno, di nome Harry Potter, sulla porta di casa degli zii Vernon e Petunia Dursley. Silente lascia anche una lettera in cui spiega che i genitori del bambino sono morti e in cui chiede di prendersi cura del piccolo.Harry cresce infelice in casa Dursley, tormentato dalle angherie del cugino Dudley e degli zii, che non perdono occasione per punirlo e mortificarlo: lo fanno dormire nel ripostiglio pieno di ragni sotto le scale, lo vestono solo con gli enormi vestiti smessi di Dudley, lo privano dei giochi e non gli permettono mai di divertirsi o di essere felice in qualsiasi modo...
            </p>
          </div>
        </div>
        <div class='row readmore'>
          <a href='/readmore/1234'>
            <div class='col-xs-12'>
              <p class='text-center'>Leggi di più</p>
            </div>
          </a>
        </div>
        <hr />
        <loan-button-element></loan-button-element>
        <hr />
        <box-list-element></box-list-element>
        <hr />
        <box-library-element></box-library-element/>
        <hr />
        <remove-book-button-element></remove-book-button-element>
      </div>
      <paper-dialog id='bookStatus'>
        <div class='container' id='radioForStatus'>
          <template is="dom-repeat" items="{{radioForStatus}}">
            <radio-status-book-element id='{{item.id}}' radiohandler='{{radioHandler(item.id, "radioForStatus")}}' text='{{item.text}}'></radio-status-book-element>
          </template>
        </div>
        <div class="buttons">
          <paper-button dialog-dismiss>Annulla</paper-button>
          <paper-button dialog-confirm>OK</paper-button>
        </div>
      </paper-dialog>
      <paper-dialog id='boughtStatus'>
        <div class='container' id='radioForAcquistato'>
          <template is="dom-repeat" items="{{radioForAcquistato}}">
            <radio-status-book-element id='{{item.id}}' radiohandler='{{radioHandler(item.id, "radioForAcquistato")}}' text='{{item.text}}'></radio-status-book-element>
          </template>
        </div>
        <div class="buttons">
          <paper-button dialog-dismiss>Annulla</paper-button>
          <paper-button dialog-confirm>OK</paper-button>
        </div>
      </paper-dialog>
      <paper-toast id="addBook" text="Libro aggiunto con successo." class="" aria-hidden="true"></paper-toast>
    </paper-header-panel>
  </template>
</dom-module>

<script>

  Polymer({
    is: "book-detail-element",
    properties: {
      radioForStatus: {
        type: Array,
        value: [
          {id: 's1', text: 'Letto'},
          {id: 's2', text: 'Da leggere'},
          {id: 's3', text: 'Leggendo attualmente'}
        ]
      },
      radioForAcquistato: {
        type: Array,
        value: [
          {id: 'b1', text: 'Acquistato'},
          {id: 'b2', text: 'Non acquistato'}
        ]
      }
    },
    goBack: function () {
      this.async(function () {
        page.redirect('/');
      }, 100);
    },
    openStatusBookDialog: function() {
      this.$.bookStatus.open();
    },
    openStatusBoughtDialog: function() {
      this.$.boughtStatus.open();
    },
    radioHandler: function(id, dataSet) {
      var that = this;
      return function() {
        var scope = that.$[dataSet];
        that[dataSet].forEach(function (status) {
          if (status.id !== id) {
            Polymer.dom(scope).querySelector('#' + status.id).removeSelection();
          }
        });
      }
    }
  });
</script>
