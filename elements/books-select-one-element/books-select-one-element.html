
<dom-module id="books-select-one-element">
  <style>

    paper-input, paper-input-container {
      color: #000;
    }
    paper-toolbar {
      vertical-align: middle;
    }

    paper-toolbar p {
      margin: 0;
      padding: 0;
    }

    .fab-text-overlay {
      position: fixed;
      z-index: 110;
      bottom: 42px;
      right: 47px;
      font-size: 86%;
      color: #fff;
    }

  </style>
  <template>
    <paper-header-panel flex>
      <paper-toolbar role="toolbar" elevation="1">
        <div class='back' on-click="goBack">
          <paper-icon-button id="navicon" icon="arrow-back"></paper-icon-button>
        </div>
        <p>{{contentTitle}}</p>
      </paper-toolbar>

      <div class='container'>
        <div class='row'>
          <!-- <div class='col-xs-12'>
            <liste-list-item-element></liste-list-item-element>
          </div> -->
          <div class='col-xs-12'>
            <paper-tabs selected="{{pageSelected}}">
      	      <paper-tab>Libri gi√† catalogati</paper-tab>
      	      <paper-tab>Libri da GoodReads</paper-tab>
      	    </paper-tabs>
            <iron-pages selected="{{pageSelected}}">
      				<div id='myCatalog'>
                <template is="dom-repeat" items="{{booksFromMyCatalog}}">
                  <book-radio-item-element id='{{item.id}}' radiohandler='{{radioHandler(item.id)}}'></book-radio-item-element>
                </template>
              </div>
              <div id='goodreadsCatalog'>
                <template is="dom-repeat" items="{{booksFromGoodreads}}">
                  <book-radio-item-element id='{{item.id}}' radiohandler='{{radioHandler(item.id)}}'></book-radio-item-element>
                </template>
              </div>
            </iron-pages>
          </div>
        </div>

      </div>

      <paper-fab icon="arrow-forward" on-click='saveBooks' id='nextButton'></paper-fab>
      <!--<span class='fab-text-overlay'>Scegli</span>-->
    </paper-header-panel>
  </template>
</dom-module>

<script>
  Polymer({
    is: "books-select-one-element",

    properties: {
      visibilityValue: {
        type: Boolean,
        value: false
      },
      contentTitle: {
        type: String,
        value: "Romanzi preferiti"
      },
      pageSelected: {
        type: Number,
        value: 0
      },
      type: {
        type: String
      },
      booksFromMyCatalog: {
        type: Array,
        value: [
          { id: 'b1', name: 'Orgoglio e Pregiudizio' },
          { id: 'b2', name: 'Orgoglio e Pregiudizio' },
          { id: 'b3', name: 'Orgoglio e Pregiudizio' }
        ]
      },
      booksFromGoodreads: {
        type: Array,
        value: [
          { id: 'g1', name: 'Orgoglio e Pregiudizio' },
          { id: 'g2', name: 'Orgoglio e Pregiudizio' },
          { id: 'g3', name: 'Orgoglio e Pregiudizio' },
          { id: 'g4', name: 'Orgoglio e Pregiudizio' },
          { id: 'g5', name: 'Orgoglio e Pregiudizio' }
        ]
      }
    },

    goBack: function () {
      var contentType = this.type;
      this.async(function () {
        if (contentType === 'library') {
          page.redirect('/new/library');
        } else if (contentType === 'lista') {
          page.redirect('/new/lista');
        } else if (contentType === 'loan') {
          page.redirect('/');
        } else if (contentType === 'book') {
          page.redirect('/');
        }
      }, 100);
    },

    end: function () {
      var contentType = this.type;
      this.async(function () {
        if (contentType === 'library') {
          page.redirect('/library/detail');
        } else if (contentType === 'lista') {
          page.redirect('/lista/detail');
        } else if (contentType === 'loan') {
          page.redirect('/new/loan');
        } else if (contentType === 'book') {
          page.redirect('/book/code?toast=addBook');
        }

      }, 100);
    },

    saveBooks: function () {
      // var scope = (this.pageSelected === 0) ? this.$.myCatalog : this.$.goodreadsCatalog;
      // var items = Polymer.dom(scope).querySelectorAll('book-checkbox-item-element');
      // var itemsSelected = [];
      // for (var i = 0; i < items.length; ++i) {
      //   if (items[i].selected) {
      //     itemsSelected.push(items[0])
      //   }
      // }
      this.end();
    },

    radioHandler: function (bookId) {
      var that = this;

      return function () {

        var scope, catalog;
        if (that.pageSelected === 0) {
          scope = that.$.myCatalog;
          catalog = that.booksFromMyCatalog;
        } else {
          scope = that.$.goodreadsCatalog;
          catalog = that.booksFromGoodreads;
        }

        catalog.forEach(function (bookElement) {
          if (bookElement.id !== bookId){
            Polymer.dom(scope).querySelector('#' + bookElement.id).removeSelection();
          }
        })
      };
    },

    visibilityChanged: function (toggle) {
      this.visibilityValue = this.$.visibility.selected;
    },

    ready: function () {

      if (this.type === 'loan') {
        this.contentTitle = "Nuovo prestito";
      }
    }

  });
</script>
