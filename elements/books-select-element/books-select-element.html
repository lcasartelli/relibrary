
<dom-module id="books-select-element">
  <style>

    paper-input, paper-input-container {
      color: #000;
    }
    paper-toolbar {
      vertical-align: middle;
    }

    paper-toolbar p {
      margin: 0;
      padding: 0;
    }

    .search {
      margin: auto;
      margin-right: 0px;
    }


  </style>
  <template>
    <paper-header-panel flex>
      <paper-toolbar role="toolbar" elevation="1">
        <div class='back' on-click="goBack">
          <paper-icon-button id="navicon" icon="arrow-back"></paper-icon-button>
        </div>
        <p>Scelta libri per "<span>{{contentTitle}}</span>"</p>
        <div class='search' on-click="goSearch">
          <paper-icon-button id="search" icon="search"></paper-icon-button>
        </div>
      </paper-toolbar>

      <div class='container'>
        <div class='row'>
          <!-- <div class='col-xs-12'>
            <liste-list-item-element></liste-list-item-element>
          </div> -->
          <div class='col-xs-12'>
            <paper-tabs selected="{{pageSelected}}">
      	      <paper-tab>Libri gi√† catalogati</paper-tab>
      	      <paper-tab>Libri da GoodReads</paper-tab>
      	    </paper-tabs>
            <iron-pages selected="{{pageSelected}}">
      				<div id='myCatalog'>
                <book-checkbox-item-element></book-checkbox-item-element>
                <book-checkbox-item-element></book-checkbox-item-element>
              </div>
              <div id='goodreadsCatalog'>
                <book-checkbox-item-element></book-checkbox-item-element>
                <book-checkbox-item-element></book-checkbox-item-element>
                <book-checkbox-item-element></book-checkbox-item-element>
                <book-checkbox-item-element></book-checkbox-item-element>
              </div>
            </iron-pages>
          </div>
        </div>

      </div>

      <paper-fab icon="done" on-click='saveBooks'></paper-fab>
    </paper-header-panel>

    <paper-dialog id='noBooksAlert'>
      <div>
        Ops, non hai selezionato nessun libro.
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss>Indietro</paper-button>
        <paper-button dialog-confirm on-click='end'>Procedi comunque</paper-button>
      </div>
    </paper-dialog>

  </template>
</dom-module>

<script>
  Polymer({
    is: "books-select-element",

    properties: {
      visibilityValue: {
        type: Boolean,
        value: false
      },
      contentTitle: {
        type: String,
        value: "Romanzi preferiti"
      },
      pageSelected: {
        type: Number,
        value: 0
      },
      type: {
        type: String
      },
      isnew: {
        type: String
      },
    },

    goBack: function () {
      var contentType = this.type;
      this.async(function () {
        if (contentType === 'library') {
          page.redirect('/new/library');
        } else {
          page.redirect('/new/lista');
        }
      }, 100);
    },

    end: function () {
      var contentType = this.type;
      this.async(function () {
        if (contentType === 'library') {
          var toast = (this.isnew === 'true') ? 'addLibrary' : 'editLibrary'
          page.redirect('/library/detail?toast=' + toast);
        } else {
          var toast = (this.isnew === 'true') ? 'addList' : 'editList'
          page.redirect('/lista/detail?toast=' + toast);
        }

      }, 100);
    },

    saveBooks: function () {
      var scope = (this.pageSelected === 0) ? this.$.myCatalog : this.$.goodreadsCatalog;
      var items = Polymer.dom(scope).querySelectorAll('book-checkbox-item-element');
      var itemsSelected = [];
      for (var i = 0; i < items.length; ++i) {
        if (items[i].selected) {
          itemsSelected.push(items[0])
        }
      }
      if (itemsSelected.length === 0) {
        // no book selected, show alert
        this.$.noBooksAlert.open();
      } else {
        this.end();
      }

    },

    visibilityChanged: function (toggle) {
      this.visibilityValue = this.$.visibility.checked;
    },

    ready: function () {
      if (this.type === 'library') {
        this.contentTitle = "Libreria Grande";
      } else {
        this.contentTitle = "Romanzi preferiti";
      }
    }

  });
</script>
